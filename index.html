<!DOCTYPE html>
<!--
  Summary:
  - Single-page gallery with animated hue blobs, ambient audio, and a "Pat the feesh" counter.
  - Gallery images load from images.json (WebP) but link to original files in /img.
  - A Worker endpoint provides the global counter value.

  Blub Blub
-->
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Salty Soya</title>
    <link rel="icon" type="image/png" href="favicon.png" />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,700&display=swap");

      :root {
        color-scheme: light;
        --bg: #ffffff;
        --text: #1c1b18;
        --accent: #8b6f47;
        --page-pad-y: 48px;
        --page-pad-x: 24px;
        --blob-1: rgba(255, 190, 215, 0.62);
        --blob-2: rgba(255, 170, 200, 0.68);
        --blob-3: rgba(255, 200, 230, 0.6);
        --blob-4: rgba(255, 180, 210, 0.68);
        --blob-5: rgba(255, 200, 225, 0.68);
        --blob-6: rgba(255, 185, 215, 0.6);
        --blob-7: rgba(255, 175, 205, 0.7);
        --blob-8: rgba(255, 205, 235, 0.62);
        --blob-9: rgba(255, 195, 220, 0.68);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Fraunces", serif;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
        padding: var(--page-pad-y) var(--page-pad-x);
      }

      .page {
        position: relative;
        min-height: 100vh;
        overflow: hidden;
        width: 100vw;
        margin-left: calc(50% - 50vw);
        margin-right: calc(50% - 50vw);
        margin: calc(var(--page-pad-y) * -1) calc(var(--page-pad-x) * -1);
        padding: var(--page-pad-y) var(--page-pad-x);
      }

      .wrap {
        text-align: center;
        width: 100%;
        max-width: none;
        position: relative;
        z-index: 1;
      }

      h1 {
        margin: 0;
        font-size: clamp(2.5rem, 6vw, 4rem);
        letter-spacing: 0.02em;
      }

      .spacer {
        height: 24px;
      }

      /* Button styling for the feesh interaction */
      .feesh-button {
        margin-top: 8px;
        padding: 12px 22px;
        border-radius: 999px;
        border: 1px solid rgba(139, 111, 71, 0.4);
        background: rgba(255, 255, 255, 0.8);
        color: #4a3c2b;
        font-size: 1rem;
        letter-spacing: 0.01em;
        cursor: pointer;
        transition: transform 0.12s ease, box-shadow 0.12s ease;
      }

      .feesh-button-wrap {
        position: relative;
        display: inline-block;
      }

      .feesh-gif {
        position: absolute;
        top: 50%;
        width: 80px;
        height: auto;
        transform: translateY(-50%);
        pointer-events: none;
        opacity: 0;
        animation: feeshFade 3s ease-in-out forwards;
      }

      .feesh-gif.left {
        right: 100%;
        margin-right: clamp(8px, 2vw, 18px);
      }

      .feesh-gif.right {
        left: 100%;
        margin-left: clamp(8px, 2vw, 18px);
      }

      @keyframes feeshFade {
        0% {
          opacity: 0;
          transform: translateY(-50%) scale(0.96);
        }
        15% {
          opacity: 1;
          transform: translateY(-50%) scale(1);
        }
        85% {
          opacity: 1;
          transform: translateY(-50%) scale(1);
        }
        100% {
          opacity: 0;
          transform: translateY(-50%) scale(0.98);
        }
      }

      .feesh-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 8px 18px rgba(90, 46, 63, 0.18);
      }

      .feesh-button:active {
        transform: translateY(0);
        box-shadow: none;
      }

      /* Error text shown when the counter API fails */
      .feesh-fallback {
        margin: 8px 0 0;
        font-size: 0.9rem;
        color: #6f4d58;
        min-height: 1.1em;
        display: none;
      }

      /* Counter layout above the button */
      .feesh-counter {
        margin: 8px 0 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
      }

      .feesh-counter-label {
        font-size: 1rem;
        color: #6f4d58;
      }

      .feesh-counter-value {
        font-size: 1.6rem;
        font-weight: 700;
        color: #6f4d58;
      }

      .divider {
        width: 72px;
        height: 3px;
        margin: 0 auto;
        background: var(--accent);
        border-radius: 999px;
      }

      h2 {
        margin: 20px 0 0;
        font-size: clamp(1.4rem, 3vw, 2rem);
        font-weight: 400;
        color: #4a3c2b;
      }

      /* Subtitle text under the Gallery divider */
      .gallery-subtitle {
        margin: 12px 0 0;
        font-size: 1rem;
        color: #6f4d58;
      }

      .intro-video {
        width: min(900px, 92%);
        margin: 16px auto 0;
        display: block;
        border-radius: 16px;
        box-shadow: 0 14px 28px rgba(0, 0, 0, 0.12);
      }

      .video-actions {
        width: min(900px, 100%);
        margin: 16px auto 0;
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 16px;
      }

      .video-panels {
        width: min(900px, 100%);
        margin: 12px auto 0;
        display: grid;
        gap: 12px;
      }

      .action-button {
        width: fit-content;
        justify-self: center;
        display: inline-block;
        padding: 16px 26px;
        border-radius: 999px;
        border: 1px solid rgba(139, 111, 71, 0.4);
        background: rgba(255, 255, 255, 0.85);
        color: #4a3c2b;
        font-size: 1.15rem;
        cursor: pointer;
        transition: transform 0.12s ease, box-shadow 0.12s ease;
      }

      .action-button:hover {
        transform: translateY(-1px);
        box-shadow: 0 8px 18px rgba(90, 46, 63, 0.18);
      }

      .action-button[aria-expanded="true"] {
        box-shadow: 0 10px 22px rgba(90, 46, 63, 0.2);
      }

      .action-panel {
        display: none;
        padding: 16px 18px;
        border-radius: 16px;
        background: rgba(255, 255, 255, 0.85);
        border: 1px solid rgba(139, 111, 71, 0.2);
        color: #6f4d58;
        font-size: 0.95rem;
              max-width: 100%;
        overflow-wrap: anywhere;
}

      .action-panel.centered-panel {
        text-align: center;
      }

      .action-panel.large-panel {
        font-size: 1.4rem;
      }

      .action-panel.centered-panel .action-item {
        justify-content: center;
      }

      .action-panel.is-open {
        display: block;
      }

      .action-list {
        display: grid;
        gap: 6px;
      }

      .action-sublist {
        margin: 6px 0 0;
        display: grid;
        gap: 6px;
      }

      .action-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .action-item img {
        width: 16px;
        height: 16px;
      }

      .action-link {
        color: inherit;
        text-decoration: none;
      }

      .action-link:hover,
      .action-link:focus {
        text-decoration: underline;
      }

      .action-item::before {
        content: "✦";
        color: #8b6f47;
      }

      .action-item.has-icon::before {
        content: none;
      }

      .action-sublist .action-item::before {
        content: none;
      }

      .sub-spacer {
        height: 28px;
      }

      /* Floating hue blobs animated by script.js */
      .hue-blob {
        position: absolute;
        pointer-events: none;
        z-index: 0;
        border-radius: 50%;
        filter: blur(5px);
        opacity: 0.9;
        mix-blend-mode: multiply;
        transform: translate3d(var(--drift-x, 0px), var(--drift-y, 0px), 0);
        transition: transform 0.12s ease-out;
      }

      .hue-blob.b1 {
        width: 520px;
        height: 520px;
        top: 12%;
        right: 50%;
        background: radial-gradient(circle, var(--blob-1), transparent 72%);
      }

      .hue-blob.b2 {
        width: 420px;
        height: 420px;
        top: 58%;
        left: 8%;
        background: radial-gradient(circle, var(--blob-2), transparent 70%);
      }

      .hue-blob.b3 {
        width: 460px;
        height: 460px;
        top: 30%;
        left: 55%;
        background: radial-gradient(circle, var(--blob-3), transparent 74%);
      }

      .hue-blob.b4 {
        width: 380px;
        height: 380px;
        top: 78%;
        right: 15%;
        background: radial-gradient(circle, var(--blob-4), transparent 68%);
      }

      .hue-blob.b5 {
        width: 300px;
        height: 300px;
        top: 5%;
        left: 18%;
        background: radial-gradient(circle, var(--blob-5), transparent 68%);
      }

      .hue-blob.b6 {
        width: 340px;
        height: 340px;
        top: 18%;
        right: 12%;
        background: radial-gradient(circle, var(--blob-6), transparent 70%);
      }

      .hue-blob.b7 {
        width: 420px;
        height: 420px;
        top: 46%;
        left: 20%;
        background: radial-gradient(circle, var(--blob-7), transparent 72%);
      }

      .hue-blob.b8 {
        width: 360px;
        height: 360px;
        top: 64%;
        left: 62%;
        background: radial-gradient(circle, var(--blob-8), transparent 70%);
      }

      .hue-blob.b9 {
        width: 300px;
        height: 300px;
        top: 88%;
        right: 25%;
        background: radial-gradient(circle, var(--blob-9), transparent 68%);
      }

      /* Gallery container and spacing */
      .gallery {
        width: 100%;
        padding: 0 96px;
        margin: 0 auto;
      }

      /* Masonry-like column layout */
      .gallery-grid {
        column-count: 4;
        column-gap: 16px;
      }

      /* Individual image card */
      .gallery-item {
        display: inline-block;
        width: 100%;
        margin: 0 0 16px;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 10px 24px rgba(0, 0, 0, 0.12);
        background: #efe7dd;
      }

      .gallery-item img {
        display: block;
        width: 100%;
        height: auto;
        object-fit: cover;
      }

      /* Sticker row above the footer */
      .sticker-row {
        position: relative;
        z-index: 1;
        display: flex;
        justify-content: center;
        align-items: flex-end;
        gap: 80px;
        margin-top: 0;
      }

      .sticker-row img {
        width: clamp(110px, 18vw, 180px);
        height: auto;
        filter: drop-shadow(0 10px 18px rgba(90, 46, 63, 0.18));
        opacity: 0.95;
      }

      .sticker-left {
        transform: translateX(-20px);
      }

      .sticker-right {
        transform: translateX(20px);
      }

      /* Footer text styling */
      .footer {
        text-align: center;
        margin-top: 28px;
        color: #6f4d58;
        font-size: 0.95rem;
      }

      body {
        overflow-x: hidden;
      }

      @media (max-width: 640px) {
        .sticker-row {
          gap: 48px;
        }

        :root {
          --page-pad-y: 32px;
          --page-pad-x: 16px;
        }
        body {
          padding: 32px 16px;
        }

        .gallery {
          padding: 0 40px;
        }

        .video-actions {
          grid-template-columns: 1fr;
        }

        .video-panels {
          width: 100%;
          padding: 0 12px;
        }

        .video-panels .action-list {
          gap: 12px;
        }

        .video-panels .action-sublist {
          gap: 10px;
        }

      }

      @media (max-width: 1100px) {
        .gallery-grid {
          column-count: 3;
        }
      }

      @media (max-width: 820px) {
        .gallery-grid {
          column-count: 2;
        }
      }

      @media (max-width: 520px) {
        .gallery-grid {
          column-count: 1;
        }
      }

    </style>
  </head>
  <body>
    <div class="page">
      <div class="hue-blob b1" aria-hidden="true"></div>
      <div class="hue-blob b2" aria-hidden="true"></div>
      <div class="hue-blob b3" aria-hidden="true"></div>
      <div class="hue-blob b4" aria-hidden="true"></div>
      <div class="hue-blob b5" aria-hidden="true"></div>
      <div class="hue-blob b6" aria-hidden="true"></div>
      <div class="hue-blob b7" aria-hidden="true"></div>
      <div class="hue-blob b8" aria-hidden="true"></div>
      <div class="hue-blob b9" aria-hidden="true"></div>
      <main class="wrap">
        <h1>Salty Soya</h1>
        <div class="spacer"></div>
        <div class="divider" id="feesh-divider"></div>
        <h2>a friendly water demon focusing on content that makes people comfy and relaxed</h2>
        <video
          class="intro-video"
          autoplay
          muted
          loop
          playsinline
          preload="auto"
        >
          <source src="vid/Obake_2.webm" type="video/webm" />
        </video>
        <div class="video-actions">
          <button
            class="action-button"
            type="button"
            aria-expanded="false"
            data-panel="panel-left"
          >
            links
          </button>
          <button
            class="action-button"
            type="button"
            aria-expanded="false"
            data-panel="panel-right"
          >
            credits
          </button>
        </div>
        <div class="video-panels">
          <div id="panel-left" class="action-panel centered-panel large-panel">
            <div class="action-list">
              <div class="action-item has-icon">
                <img src="icon/twitch.svg" alt="" aria-hidden="true" />
                <a class="action-link" href="https://www.twitch.tv/saltysoya" target="_blank" rel="noopener noreferrer">Twitch</a>
              </div>
              <div class="action-item has-icon">
                <img src="icon/discord.svg" alt="" aria-hidden="true" />
                <a class="action-link" href="https://discord.gg/saltysoya" target="_blank" rel="noopener noreferrer">Discord</a>
              </div>
              <div class="action-item has-icon">
                <img src="icon/youtube.svg" alt="" aria-hidden="true" />
                <a class="action-link" href="https://www.youtube.com/@saltysoyaasmr" target="_blank" rel="noopener noreferrer">ASMR YouTube Channel</a>
              </div>
              <div class="action-item has-icon">
                <img src="icon/youtube.svg" alt="" aria-hidden="true" />
                <a class="action-link" href="https://www.youtube.com/@SaltySoya_VODs" target="_blank" rel="noopener noreferrer">VOD YouTube Channel</a>
              </div>
              <div class="action-item has-icon">
                <img src="icon/youtube.svg" alt="" aria-hidden="true" />
                <a class="action-link" href="https://www.youtube.com/@saltysoya" target="_blank" rel="noopener noreferrer">Non ASMR YouTube Channel</a>
              </div>
              <div class="action-item has-icon">
                <img src="icon/x.svg" alt="" aria-hidden="true" />
                <a class="action-link" href="https://x.com/SaltySoyaVT" target="_blank" rel="noopener noreferrer">Twitter X</a>
              </div>
              <div class="action-item has-icon">
                <img src="icon/patreon.svg" alt="" aria-hidden="true" />
                <a class="action-link" href="https://patreon.com/SaltySoya" target="_blank" rel="noopener noreferrer">Patreon</a>
              </div>
              <div class="action-item has-icon">
                <img src="icon/undertale_heart.svg" alt="" aria-hidden="true" />
                <a class="action-link" href="https://donationalerts.com/r/saltysoya" target="_blank" rel="noopener noreferrer">Donations</a>
              </div>
              <div class="action-item has-icon">
                <img src="icon/throne.svg" alt="" aria-hidden="true" />
                <a class="action-link" href="https://throne.com/saltysoya" target="_blank" rel="noopener noreferrer">Throne</a>
              </div>
              <div class="action-item has-icon">
                <img src="icon/gmail.svg" alt="" aria-hidden="true" />
                <a class="action-link" href="mailto:saltysoya0.1@gmail.com">E-Mail</a>
              </div>
            </div>
          </div>
          <div id="panel-right" class="action-panel large-panel centered-panel">
            <div class="action-list">
              <div class="action-item">
                Emotes ➜
                <a class="action-link" href="https://x.com/ikuraisora" target="_blank" rel="noopener noreferrer">iyumei</a>
              </div>
              <div class="action-item">
                Emote animation ➜
                <a class="action-link" href="https://x.com/Maddemian1" target="_blank" rel="noopener noreferrer">Mad_demian</a>
              </div>
              <div class="action-item">
                Twitch panels ➜
                <a class="action-link" href="https://vk.com/ppimpeachie" target="_blank" rel="noopener noreferrer">Pimu Peachie✧</a>
              </div>
              <div class="action-item">
                Twitch overlays ➜
                <a class="action-link" href="https://www.fiverr.com/s/VYraajm" target="_blank" rel="noopener noreferrer">Obellie</a>
              </div>
              <div class="action-item">
                Sub badges ➜
                <a class="action-link" href="https://www.fiverr.com/s/P24kA4p" target="_blank" rel="noopener noreferrer">Sweetarcade</a>
              </div>
              <div class="action-item">
                Backgrounds ➜
                <a class="action-link" href="https://digitalgem.booth.pm/items/4986231" target="_blank" rel="noopener noreferrer">Rainy room</a>
                ☽｡⋆
                <a class="action-link" href="https://digitalgem.booth.pm/items/5224455" target="_blank" rel="noopener noreferrer">Winter room</a>
              </div>
              <div class="action-item">
                3D Model ➜
                <a class="action-link" href="https://booth.pm/en/items/5354471" target="_blank" rel="noopener noreferrer">こまど / komado</a>
              </div>
              <div class="action-item">
                3D Model assets ➜
              </div>
              <div class="action-sublist">
                <div class="action-item">
                  <a class="action-link" href="https://booth.pm/en/items/5503436" target="_blank" rel="noopener noreferrer">Pisces hair うお座ヘア</a>
                </div>
                <div class="action-item">
                  <a class="action-link" href="https://valice.booth.pm/items/5477874" target="_blank" rel="noopener noreferrer">おだんごエクステ Bun extension</a>
                </div>
                <div class="action-item">
                  <a class="action-link" href="https://ichicoro.booth.pm/items/5672999" target="_blank" rel="noopener noreferrer">YO-SORO! Sailor Marin【複数アバター対応】</a>
                </div>
                <div class="action-item">
                  <a class="action-link" href="https://todaycloth.booth.pm/items/5471358" target="_blank" rel="noopener noreferrer">Tail</a>
                </div>
                <div class="action-item">
                  <a class="action-link" href="https://cybercritter.booth.pm/items/5572808" target="_blank" rel="noopener noreferrer">ドラゴン・メイジ</a>
                </div>
                <div class="action-item">
                  <a class="action-link" href="https://kamony-land.booth.pm/items/5072756" target="_blank" rel="noopener noreferrer">Shark Hoodie</a>
                </div>
                <div class="action-item">
                  <a class="action-link" href="https://aruarua.booth.pm/items/4925778" target="_blank" rel="noopener noreferrer">Short Hair Style</a>
                </div>
                <div class="action-item">
                  <a class="action-link" href="https://meltlyric.booth.pm/items/5478350" target="_blank" rel="noopener noreferrer">Knit sweater-dress</a>
                </div>
                <div class="action-item">
                  <a class="action-link" href="https://pii34.booth.pm/items/5222688" target="_blank" rel="noopener noreferrer">『ゆめいろワンピース』</a>
                </div>
                <div class="action-item">
                  <a class="action-link" href="https://fiona.booth.pm/items/4927845" target="_blank" rel="noopener noreferrer">Twin tail hairstyle</a>
                </div>
                <div class="action-item">
                  <a class="action-link" href="https://demicrown.booth.pm/items/5051926" target="_blank" rel="noopener noreferrer">Dancing Outfit</a>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="sub-spacer"></div>
        <h2>pat the cute demon</h2>
        <div class="divider" id="feesh-divider"></div>
        <div id="feesh-counter" class="feesh-counter">
          <span class="feesh-counter-label">the cute water demon has been patted</span>
          <span id="feesh-counter-value" class="feesh-counter-value">0</span>
          <span class="feesh-counter-label">times</span>
        </div>
        <p id="feesh-counter-fallback" class="feesh-fallback" aria-live="polite"></p>
        <div class="feesh-button-wrap" id="feesh-button-wrap">
          <button id="feesh-button" class="feesh-button" type="button">
            pat the demon
          </button>
        </div>
        <div class="spacer"></div>
        <h2>gallery</h2>
        <div class="divider"></div>
        <p class="gallery-subtitle">
          some fanart/pictures taken from the offical
          <a class="action-link" href="https://discord.gg/saltysoya" target="_blank" rel="noopener noreferrer">discord server</a>
        </p>
        <p class="gallery-subtitle">clicking an image opens it to full size</p>
        <div class="spacer"></div>
        <section class="gallery" aria-label="Image gallery">
          <div id="gallery-grid" class="gallery-grid"></div>
        </section>
      </main>
      <div class="sticker-row" aria-hidden="true">
        <img class="sticker-left" src="suba_comm_stickers_zorua.png" alt="" />
        <img class="sticker-right" src="suba_comm_stickers_soy.png" alt="" />
      </div>
      <div class="footer">
        made by <a href="https://lukimana.moe" target="_blank" rel="noopener noreferrer"> lukimana</a><br />
        with music from <a href="https://vndb.org/v24717" target="_blank" rel="noopener noreferrer">kinkoi</a><br />
        and footer images created by <a href="https://kybit.carrd.co/" target="_blank" rel="noopener noreferrer">Ky</a><br />
      </div>
    </div>
    <audio
      id="ambient-audio"
      src="music/12-Golden Time.mp3"
      autoplay
      loop
      preload="auto"
    ></audio>
    <script src="script.js"></script>
    <script>
      const galleryGrid = document.getElementById("gallery-grid");
      const feeshButton = document.getElementById("feesh-button");
      const feeshCounter = document.getElementById("feesh-counter");
      const feeshCounterValue = document.getElementById("feesh-counter-value");
      const feeshFallback = document.getElementById("feesh-counter-fallback");
      const feeshButtonWrap = document.getElementById("feesh-button-wrap");
      const feeshCounterTop = document.getElementById("feesh-counter");
      const feeshApi = "https://api.saltysoya.moe/api/feesh";

      // Loads the WebP gallery list, renders tiles, and maps clicks to originals.
      fetch("images.json")
        .then((response) => response.json())
        .then((images) => {
          const originalExtensions = ["png", "jpg", "jpeg"];

          // Finds the matching original image in /img by probing common extensions.
          const resolveOriginal = async (webpPath) => {
            const fileName = webpPath.split("/").pop() || "";
            const baseName = fileName.replace(/\.(webp|avif)$/i, "");
            for (const ext of originalExtensions) {
              const candidate = `img/${baseName}.${ext}`;
              try {
                const res = await fetch(candidate, { method: "HEAD" });
                if (res.ok) {
                  return candidate;
                }
              } catch (error) {
                // Ignore and try next extension.
              }
            }
            return `img/${baseName}.png`;
          };

          images
            .sort(() => Math.random() - 0.5)
            .forEach((src) => {
            const link = document.createElement("a");
            link.className = "gallery-item";
            link.target = "_blank";
            link.rel = "noopener";
            link.dataset.webp = src;

            const img = document.createElement("img");
            img.loading = "lazy";
            img.decoding = "async";
            img.src = src;
            img.alt = "";

            link.appendChild(img);
            galleryGrid.appendChild(link);

            link.addEventListener("click", (event) => {
              event.preventDefault();
              const webpPath = link.dataset.webp || src;
              resolveOriginal(webpPath).then((originalSrc) => {
                window.open(originalSrc, "_blank", "noopener");
              });
            });
          });
        })
        .catch((error) => {
          console.error("Failed to load gallery images:", error);
        });

      if (feeshButton) {
        const feeshSounds = [
          "music/mhm1.wav",
          "music/mhm2.wav",
          "music/mhm3.wav",
          "music/mhm4.wav",
        ];

        const feeshGifs = [
          "gif/image01.gif",
          "gif/image02.gif",
          "gif/image03.gif",
        ];

        let lastGifTime = 0;
        let lastGifSide = null;
        let pressTimes = [];
        const lastGifBySide = { left: null, right: null };

        const showFeeshGif = () => {
          if (!feeshButtonWrap) return;
          const now = Date.now();
          pressTimes = pressTimes.filter((t) => now - t < 3000);
          if (pressTimes.length >= 2) {
            return;
          }

          const recent = now - lastGifTime < 3000;
          let side = "left";
          if (recent && lastGifSide) {
            side = lastGifSide === "left" ? "right" : "left";
          } else {
            side = Math.random() > 0.5 ? "left" : "right";
          }

          const otherSide = side === "left" ? "right" : "left";
          const otherGif = lastGifBySide[otherSide];
          const available = feeshGifs.filter((gifPath) => gifPath !== otherGif);
          const chosenList = available.length ? available : feeshGifs;
          const chosenGif =
            chosenList[Math.floor(Math.random() * chosenList.length)];

          const gif = document.createElement("img");
          gif.className = `feesh-gif ${side}`;
          gif.src = chosenGif;
          gif.alt = "";

          const marginPx = Math.max(8, Math.min(window.innerWidth * 0.02, 18));
          const buttonRect = feeshButtonWrap.getBoundingClientRect();
          const viewportWidth = window.innerWidth;
          const maxWidth =
            side === "left"
              ? buttonRect.left - marginPx
              : viewportWidth - buttonRect.right - marginPx;
          const preferredWidth = 80;

          if (maxWidth > 30) {
            gif.style.width = `${Math.max(40, Math.min(preferredWidth, maxWidth))}px`;
            gif.style.height = "auto";
          }

          gif.style.height = "auto";

          feeshButtonWrap.appendChild(gif);

          lastGifTime = now;
          lastGifSide = side;
          lastGifBySide[side] = chosenGif;
          pressTimes.push(now);

          setTimeout(() => {
            gif.remove();
          }, 3000);
        };

        // Updates the visible counter text and clears fallback messages.
        const updateFeeshCounter = (count) => {
          if (feeshCounter) {
            feeshCounter.style.display = "";
            if (feeshCounterValue) {
              feeshCounterValue.textContent = String(count);
            }
          }
          if (feeshFallback) {
            feeshFallback.style.display = "none";
            feeshFallback.textContent = "";
          }
        };

        // Loads the current global count from the Worker endpoint.
        fetch(feeshApi)
          .then((response) => response.json())
          .then((data) => {
            if (typeof data.count === "number") {
              updateFeeshCounter(data.count);
            }
          })
          .catch((error) => {
            console.error("The feesh has been patted too much. Try again later.", error);
            if (feeshFallback) {
              feeshFallback.textContent =
                "The feesh has been patted too much. Try again later.";
              feeshFallback.style.display = "block";
            }
            if (feeshCounter) {
              feeshCounter.style.display = "none";
            }
          });

        // Plays a random sound and increments the global counter.
        feeshButton.addEventListener("click", () => {
          const choice =
            feeshSounds[Math.floor(Math.random() * feeshSounds.length)];
          const audio = new Audio(choice);
          audio.volume = 0.6;
          audio.play().catch(() => {});

          showFeeshGif();

          fetch(feeshApi, { method: "POST" })
            .then((response) => response.json())
            .then((data) => {
              if (typeof data.count === "number") {
                updateFeeshCounter(data.count);
              }
            })
            .catch((error) => {
              console.error("The feesh has been patted too much. Try again later.", error);
              if (feeshFallback) {
                feeshFallback.textContent =
                  "The feesh has been patted too much. Try again later.";
                feeshFallback.style.display = "block";
              }
              if (feeshCounter) {
                feeshCounter.style.display = "none";
              }
            });
        });
      }

      const actionButtons = document.querySelectorAll(".action-button");
      actionButtons.forEach((button) => {
        button.addEventListener("click", () => {
          const panelId = button.getAttribute("data-panel");
          if (!panelId) return;
          const panel = document.getElementById(panelId);
          if (!panel) return;

          const isOpen = panel.classList.toggle("is-open");
          button.setAttribute("aria-expanded", isOpen ? "true" : "false");
        });
      });
    </script>
  </body>
</html>






